<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Alejandra & Ever üíç</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:"Georgia",serif;
  background:linear-gradient(#fff,#f9f6f7);
  text-align:center;
  color:#7b1e3a;
}
.container{max-width:640px;margin:auto;padding:40px 20px}
h1{font-size:38px}
.fecha{margin-bottom:30px;color:#a23b5c}
.card{
  background:white;
  padding:32px;
  border-radius:26px;
  box-shadow:0 14px 35px rgba(0,0,0,.08)
}
input[type=file]{margin-top:15px}
button{
  margin-top:22px;
  background:#7b1e3a;
  color:white;
  border:none;
  padding:15px 40px;
  border-radius:30px;
  font-size:18px;
  cursor:pointer
}
#estado{margin-top:15px;color:#a23b5c}

/* ================= OVERLAY CARGA ================= */
.overlay{
  position:fixed;inset:0;
  background:rgba(255,255,255,.96);
  z-index:3000;
  display:none;
  align-items:center;
  justify-content:center;
  flex-direction:column
}
.loader{display:flex;gap:10px}
.loader span{
  font-size:30px;
  color:#7b1e3a;
  animation:latir 1.4s infinite ease-in-out
}
.loader span:nth-child(2){animation-delay:.2s}
.loader span:nth-child(3){animation-delay:.4s}
@keyframes latir{
  0%{transform:scale(1);opacity:.4}
  20%{transform:scale(1.4);opacity:1}
  40%{transform:scale(1);opacity:.4}
  100%{transform:scale(1);opacity:.4}
}

/* ================= CARRUSEL ================= */
.carousel{margin-top:50px;position:relative;overflow:hidden}
.track{display:flex;gap:15px;transition:transform .6s ease}
.track img{
  width:180px;height:180px;
  object-fit:cover;
  border-radius:18px;
  box-shadow:0 8px 20px rgba(0,0,0,.15);
  cursor:pointer
}
.flecha{
  position:absolute;top:50%;
  transform:translateY(-50%);
  background:rgba(0,0,0,.55);
  color:white;border:none;
  font-size:26px;padding:10px 16px;
  border-radius:50%;cursor:pointer;
  z-index:2
}
.flecha.izq{left:10px}
.flecha.der{right:10px}

/* ================= MODAL ================= */
.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.92);
  z-index:2000;
  align-items:center;
  justify-content:center;
}
.modal::before{
  content:"";
  position:absolute;
  inset:0;
  background-size:cover;
  background-position:center;
  filter:blur(30px) brightness(.5);
  transform:scale(1.1);
  z-index:-1
}
.visor{
  width:96%;
  max-width:1000px;
  height:80vh;
  background:rgba(0,0,0,.6);
  border-radius:24px;
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
  position:relative
}
.visor img,.visor iframe{
  width:100%;
  height:100%;
  object-fit:contain;
  border:none
}
.cerrar{
  position:absolute;
  top:18px;right:22px;
  font-size:38px;
  color:white;
  cursor:pointer;
  z-index:5
}

/* ===== Navegaci√≥n lateral ===== */
.nav.lado{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  background:rgba(0,0,0,.45);
  color:white;
  border:none;
  font-size:34px;
  padding:18px 20px;
  border-radius:50%;
  cursor:pointer;
  z-index:5
}
.nav.izq{left:20px}
.nav.der{right:20px}

/* ===== Contador ===== */
.contador{
  position:absolute;
  top:22px;
  right:70px;
  font-size:14px;
  color:white;
  opacity:.85;
  z-index:5
}

/* ===== Descargar ===== */
.descargar{
  position:absolute;
  bottom:28px;
  background:rgba(255,255,255,.18);
  color:white;
  border:1px solid rgba(255,255,255,.35);
  padding:8px 18px;
  border-radius:20px;
  font-size:14px;
  cursor:pointer;
  z-index:5
}
.ios-tip{
  position:absolute;
  bottom:65px;
  font-size:13px;
  color:#f1d6de;
  display:none;
  z-index:5
}
</style>
</head>

<body>

<div class="container">
  <h1>Alejandra & Ever</h1>
  <div class="fecha">üíç 5 ¬∑ septiembre ¬∑ 2026</div>

  <!-- SUBIDA -->
  <div class="card">
    <p>
      Gracias por acompa√±arnos en uno de los d√≠as m√°s felices de nuestras vidas üíï  
      Ay√∫danos a guardar estos recuerdos para siempre.
    </p>

    <input type="file" id="file" multiple accept="image/*,video/*"><br>
    <button id="btnSubir">Subir recuerdos üì∏üé•</button>
    <p id="estado"></p>
  </div>

  <h2 style="margin-top:50px;">Nuestros recuerdos üíï</h2>

  <!-- CARRUSEL -->
  <div class="carousel">
    <button class="flecha izq" onclick="mover(-1)">‚óÄ</button>
    <div class="track" id="galeria"></div>
    <button class="flecha der" onclick="mover(1)">‚ñ∂</button>
  </div>

  <button id="btnVerTodos" style="margin-top:30px">
    Ver todos los recuerdos üíñ
  </button>
</div>

<!-- OVERLAY -->
<div id="overlay" class="overlay">
  <div class="loader"><span>‚ù§</span><span>‚ù§</span><span>‚ù§</span></div>
  <p style="margin-top:18px;color:#7b1e3a">
    Estamos guardando este recuerdo con mucho amor‚Ä¶<br>
    Gracias por hacer parte de nuestra historia üíï
  </p>
</div>

<!-- MODAL -->
<div id="modal" class="modal">
  <span class="cerrar" onclick="cerrarModal()">√ó</span>

  <div class="visor" id="visor">
    <button class="nav lado izq" onclick="anterior()">‚ùÆ</button>
    <button class="nav lado der" onclick="siguiente()">‚ùØ</button>

    <div id="modalContenido"></div>

    <div id="contador" class="contador"></div>
    <button id="btnDescargar" class="descargar">Guardar recuerdo ‚¨áÔ∏è</button>
    <div id="iosTip" class="ios-tip">
      En iPhone, mant√©n presionada la imagen y toca ‚ÄúGuardar en Fotos‚Äù üíï
    </div>
  </div>
</div>

<script>
const SCRIPT_URL="https://script.google.com/macros/s/AKfycbx8VOYLQROH9355Usvu2M7mguRZ8L8X4rL9kKtkH7lTak6JRmXgQkL9BCsRWOE61b2f/exec";
const isIOS=/iPad|iPhone|iPod/.test(navigator.userAgent);

let recuerdos=[],fotos=[],idx=0,ci=0,auto=null;

/* ================= AUTOPLAY ================= */
function iniciarAuto(){
  clearInterval(auto);
  auto=setInterval(()=>mover(1),3500);
}

/* ================= SUBIR ================= */
btnSubir.onclick=async()=>{
  const files=file.files;
  if(!files.length){
    estado.innerText="Por favor selecciona al menos un recuerdo para compartir üíï";
    return;
  }
  estado.innerText="";
  overlay.style.display="flex";

  for(const f of files){
    const r=new FileReader();
    await new Promise(res=>{
      r.onload=async()=>{
        await fetch(SCRIPT_URL,{
          method:"POST",
          body:JSON.stringify({
            name:f.name,
            type:f.type,
            base64:r.result.split(",")[1]
          })
        });
        res();
      };
      r.readAsDataURL(f);
    });
  }
  overlay.style.display="none";
  estado.innerText="¬°Gracias por compartir este recuerdo tan especial! üíñ";
  cargar();
};

/* ================= CARGAR ================= */
async function cargar(){
  recuerdos=await fetch(SCRIPT_URL).then(r=>r.json());
  fotos=recuerdos.filter(r=>r.type==="image");
  renderCarrusel();
  iniciarAuto();
}
cargar();

/* ================= CARRUSEL ================= */
function renderCarrusel(){
  galeria.innerHTML="";
  fotos.forEach((f)=>{
    const i=document.createElement("img");
    i.src=f.url;
    i.onclick=()=>{
      idx=recuerdos.findIndex(r=>r.url===f.url);
      if(idx<0)return;
      mostrar();
      modal.style.display="flex";
    };
    galeria.appendChild(i);
  });
  ci=0;
  galeria.style.transform="translateX(0)";
}
function mover(d){
  if(!fotos.length)return;
  ci=(ci+d+fotos.length)%fotos.length;
  galeria.style.transform=`translateX(-${ci*195}px)`;
  iniciarAuto();
}

/* ================= MODAL ================= */
btnVerTodos.onclick=()=>{
  if(!recuerdos.length)return;
  idx=0;
  mostrar();
  modal.style.display="flex";
};

function mostrar(){
  const r=recuerdos[idx];
  modalContenido.innerHTML="";
  modal.style.backgroundImage=r.type==="image"?`url(${r.url})`:"none";

  if(r.type==="image"){
    const img=document.createElement("img");
    img.src=r.url;
    modalContenido.appendChild(img);

    btnDescargar.style.display="inline-block";
    iosTip.style.display=isIOS?"block":"none";

    btnDescargar.onclick=async()=>{
      if(isIOS){
        window.open(r.url,"_blank");
      }else{
        const blob=await fetch(r.url).then(r=>r.blob());
        const u=URL.createObjectURL(blob);
        const a=document.createElement("a");
        a.href=u;
        a.download="recuerdo.jpg";
        document.body.appendChild(a);
        a.click();
        URL.revokeObjectURL(u);
        a.remove();
      }
    };
  }else{
    const f=document.createElement("iframe");
    f.src=r.url;
    f.allow="autoplay";
    modalContenido.appendChild(f);
    btnDescargar.style.display="none";
    iosTip.style.display="none";
  }
  contador.innerText=`${idx+1} / ${recuerdos.length}`;
}

function siguiente(){idx=(idx+1)%recuerdos.length;mostrar()}
function anterior(){idx=(idx-1+recuerdos.length)%recuerdos.length;mostrar()}
function cerrarModal(){modal.style.display="none"}
</script>

</body>
</html>
