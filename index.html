<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Alejandra & Ever üíç</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:"Georgia",serif;
  background:linear-gradient(#fff,#f9f6f7);
  color:#7b1e3a;
  text-align:center;
}
.container{max-width:720px;margin:auto;padding:40px 20px}
h1,h2{margin:10px 0}
.card{
  background:white;
  padding:32px;
  border-radius:26px;
  box-shadow:0 14px 35px rgba(0,0,0,.08);
  margin-bottom:40px
}
button{
  background:#7b1e3a;
  color:white;
  border:none;
  padding:15px 40px;
  border-radius:30px;
  font-size:18px;
  cursor:pointer
}
input,textarea{
  width:90%;
  max-width:400px;
  padding:12px;
  border-radius:15px;
  border:1px solid #ccc;
  margin:8px 0;
  font-family:inherit
}
textarea{resize:none;height:90px}

/* ===== CARRUSEL ===== */
.carousel{position:relative;overflow:hidden}
.track{display:flex;gap:15px;transition:transform .6s ease}
.track img{
  width:180px;height:180px;
  object-fit:cover;border-radius:18px;
  box-shadow:0 8px 20px rgba(0,0,0,.15);
  cursor:pointer
}
.flecha{
  position:absolute;top:50%;
  transform:translateY(-50%);
  background:rgba(0,0,0,.55);
  color:white;border:none;
  font-size:26px;padding:10px 16px;
  border-radius:50%;cursor:pointer
}
.izq{left:10px}.der{right:10px}

/* ===== MODAL BASE ===== */
.modal{
  display:none;position:fixed;inset:0;
  background:rgba(0,0,0,.92);
  z-index:2000;
  align-items:center;justify-content:center
}
.cerrar{
  position:absolute;top:18px;right:22px;
  font-size:38px;color:white;cursor:pointer
}

/* ===== VISOR RECUERDOS ===== */
.visor{
  width:92%;max-width:900px;height:80vh;
  background:rgba(0,0,0,.6);
  border-radius:24px;
  display:flex;align-items:center;justify-content:center;
  overflow:hidden;position:relative
}
.visor img,.visor iframe{
  width:100%;height:100%;object-fit:contain;border:none
}
.nav{
  position:absolute;top:50%;
  transform:translateY(-50%);
  background:rgba(0,0,0,.45);
  color:white;border:none;
  font-size:34px;padding:18px 20px;
  border-radius:50%;cursor:pointer
}
.nav.izq{left:20px}.nav.der{right:20px}
.contador{
  position:absolute;top:22px;right:70px;
  font-size:14px;color:white;opacity:.85
}

/* ===== OVERLAY CARGA ===== */
.overlay{
  position:fixed;inset:0;
  background:rgba(255,255,255,.96);
  display:none;
  align-items:center;justify-content:center;
  flex-direction:column;z-index:3000
}
.loader{display:flex;gap:10px}
.loader span{
  font-size:30px;color:#7b1e3a;
  animation:latir 1.4s infinite ease-in-out
}
@keyframes latir{
  0%{transform:scale(1);opacity:.4}
  20%{transform:scale(1.4);opacity:1}
  40%{transform:scale(1);opacity:.4}
}

/* ===== MENSAJES ===== */
.visor-mensajes{
  background:white;color:#7b1e3a;
  width:96%;max-width:1100px;height:85vh;
  border-radius:26px;padding:25px;
  display:flex;flex-direction:column;position:relative
}
.mensajes-scroll{flex:1;overflow-y:auto}
.mensajes-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:18px
}
.msg{
  background:white;padding:20px;border-radius:18px;
  box-shadow:0 8px 22px rgba(0,0,0,.12);
  animation:fadeUp .4s ease
}
.msg.largo{background:#fff7f9;border-left:5px solid #f2a1b3}
.msg strong{display:block;margin-bottom:8px}
.likes{
  margin-top:10px;display:flex;gap:6px;
  align-items:center;color:#e2557b
}
.likes span{cursor:pointer;font-size:18px}
.likes span.activo{transform:scale(1.4)}
@keyframes fadeUp{
  from{opacity:0;transform:translateY(10px)}
  to{opacity:1;transform:none}
}

/* ===== CORAZONES ===== */
.corazon{
  position:fixed;top:-30px;
  color:#e2557b;font-size:20px;
  animation:caer 4s linear forwards;
  z-index:4000
}
@keyframes caer{
  to{transform:translateY(110vh);opacity:0}
}
</style>
</head>

<body>

<div class="container">

  <!-- SUBIR RECUERDOS -->
  <div class="card">
    <h1>üíç Alejandra & Ever</h1>
    <p>Gracias por acompa√±arnos üíñ</p>
    <input type="file" id="file" multiple accept="image/*,video/*">
    <br><br>
    <button onclick="subirRecuerdos()">Subir recuerdos üì∏üé•</button>
  </div>

  <!-- CARRUSEL -->
  <div class="card">
    <h2>Nuestros recuerdos üíû</h2>
    <div class="carousel">
      <button class="flecha izq" onclick="mover(-1)">‚óÄ</button>
      <div class="track" id="galeria"></div>
      <button class="flecha der" onclick="mover(1)">‚ñ∂</button>
    </div>
    <button onclick="abrirModal()">Ver todos los recuerdos üíñ</button>
  </div>

  <!-- MENSAJES -->
  <div class="card">
    <h2>üíå D√©janos un mensaje</h2>
    <input id="nombre" placeholder="Tu nombre">
    <textarea id="mensaje" placeholder="Escribe algo lindo‚Ä¶"></textarea>
    <br>
    <button onclick="enviarMensaje()">Enviar mensaje üíï</button>
    <br><br>
    <button onclick="abrirMensajes()">Ver mensajes üíå</button>
  </div>

</div>

<!-- OVERLAY -->
<div id="overlay" class="overlay">
  <div class="loader"><span>‚ù§</span><span>‚ù§</span><span>‚ù§</span></div>
  <p>Guardando con amor‚Ä¶</p>
</div>

<!-- MODAL RECUERDOS -->
<div id="modal" class="modal">
  <span class="cerrar" onclick="modal.style.display='none'">√ó</span>
  <div class="visor">
    <button class="nav izq" onclick="anterior()">‚ùÆ</button>
    <button class="nav der" onclick="siguiente()">‚ùØ</button>
    <div id="modalContenido"></div>
    <div id="contador" class="contador"></div>
  </div>
</div>

<!-- MODAL MENSAJES -->
<div id="modalMensajes" class="modal">
  <span class="cerrar" onclick="cerrarMensajes()">√ó</span>
  <div class="visor-mensajes">
    <h2>Mensajes de amor üíå</h2>
    <div id="contadorMensajes"></div>
    <input placeholder="Buscar por nombre‚Ä¶" oninput="filtrarMensajes(this.value)">
    <div class="mensajes-scroll">
      <div class="mensajes-grid" id="listaMensajes"></div>
    </div>
  </div>
</div>

<script>
const API="https://script.google.com/macros/s/AKfycbyMWZyzjjH4OqgaMr7NJkpIKWO6JMmUBKowwZDZAIYRHwmmo-MVwbqTlbOaZ-soaDEb/exec";
let recuerdos=[],idx=0,mensajesCache=[];

/* ===== RECUERDOS ===== */
async function cargarRecuerdos(){
  recuerdos=await fetch(API).then(r=>r.json());
  renderCarrusel();
}
function renderCarrusel(){
  galeria.innerHTML="";
  recuerdos.filter(r=>r.type==="image").forEach((r,i)=>{
    const img=document.createElement("img");
    img.src=r.url;
    img.onclick=()=>{idx=i;abrirModal()};
    galeria.appendChild(img);
  });
}
function mover(d){
  if(!recuerdos.length)return;
  idx=(idx+d+recuerdos.length)%recuerdos.length;
  galeria.style.transform=`translateX(-${idx*195}px)`;
}
function abrirModal(){
  mostrar();
  modal.style.display="flex";
}
function mostrar(){
  const r=recuerdos[idx];
  modalContenido.innerHTML=r.type==="image"
    ? `<img src="${r.url}">`
    : `<iframe src="${r.url}"></iframe>`;
  contador.innerText=`${idx+1} / ${recuerdos.length}`;
}
function siguiente(){idx=(idx+1)%recuerdos.length;mostrar()}
function anterior(){idx=(idx-1+recuerdos.length)%recuerdos.length;mostrar()}

async function subirRecuerdos(){
  if(!file.files.length)return alert("Selecciona archivos üíï");
  overlay.style.display="flex";
  for(const f of file.files){
    const b=await f.arrayBuffer();
    await fetch(API,{
      method:"POST",
      body:JSON.stringify({
        name:f.name,type:f.type,
        base64:btoa(String.fromCharCode(...new Uint8Array(b)))
      })
    });
  }
  overlay.style.display="none";
  cargarRecuerdos();
}

/* ===== MENSAJES ===== */
async function enviarMensaje(){
  if(!nombre.value||!mensaje.value)return;
  await fetch(API,{
    method:"POST",
    body:JSON.stringify({nombre:nombre.value,mensaje:mensaje.value})
  });
  nombre.value="";mensaje.value="";
}

async function abrirMensajes(){
  modalMensajes.style.display="flex";
  lluviaCorazones();
  const data=await fetch(API+"?mensajes=1").then(r=>r.json());
  mensajesCache=data.sort((a,b)=>new Date(b.fecha)-new Date(a.fecha));
  contadorMensajes.innerText=`üíñ ${mensajesCache.length} mensajes de amor`;
  renderMensajes(mensajesCache);
}
function cerrarMensajes(){modalMensajes.style.display="none"}
function renderMensajes(arr){
  listaMensajes.innerHTML="";
  arr.forEach(m=>{
    const d=document.createElement("div");
    d.className="msg"+(m.mensaje.length>120?" largo":"");
    d.innerHTML=`<strong>üíñ ${m.nombre}</strong>
      <p>${m.mensaje}</p>
      <div class="likes">
        <span onclick="like(this)">‚ù§Ô∏è</span><small>Me gusta</small>
      </div>`;
    listaMensajes.appendChild(d);
  });
}
function filtrarMensajes(t){
  renderMensajes(mensajesCache.filter(m=>m.nombre.toLowerCase().includes(t.toLowerCase())));
}
function like(el){el.classList.toggle("activo")}

/* ===== CORAZONES ===== */
function lluviaCorazones(){
  for(let i=0;i<20;i++){
    const c=document.createElement("div");
    c.className="corazon";
    c.innerText="‚ù§";
    c.style.left=Math.random()*100+"vw";
    c.style.animationDuration=2+Math.random()*2+"s";
    document.body.appendChild(c);
    setTimeout(()=>c.remove(),5000);
  }
}

cargarRecuerdos();
</script>

</body>
</html>
