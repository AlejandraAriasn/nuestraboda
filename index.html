<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Alejandra & Ever üíç</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:"Georgia",serif;
  background:linear-gradient(#fff,#f9f6f7);
  text-align:center;
  color:#7b1e3a;
}
.container{max-width:620px;margin:auto;padding:40px 20px}
h1{font-size:38px}
.fecha{margin-bottom:30px;color:#a23b5c}
.card{
  background:white;
  padding:32px;
  border-radius:26px;
  box-shadow:0 14px 35px rgba(0,0,0,.08)
}
input[type=file]{margin-top:15px}
button{
  margin-top:22px;
  background:#7b1e3a;
  color:white;
  border:none;
  padding:15px 40px;
  border-radius:30px;
  font-size:18px;
  cursor:pointer
}
#estado{margin-top:15px;color:#a23b5c}

/* CARRUSEL */
.carousel{margin-top:50px;position:relative;overflow:hidden}
.track{display:flex;gap:15px;transition:transform .6s ease}
.track img{
  width:180px;height:180px;
  object-fit:cover;border-radius:18px;
  box-shadow:0 8px 20px rgba(0,0,0,.15)
}
.flecha{
  position:absolute;top:50%;
  transform:translateY(-50%);
  background:rgba(0,0,0,.55);
  color:white;border:none;
  font-size:26px;padding:10px 16px;
  border-radius:50%;cursor:pointer
}
.flecha.izq{left:10px}
.flecha.der{right:10px}

/* MODAL */
.modal{
  display:none;position:fixed;inset:0;
  background:rgba(0,0,0,.92);
  z-index:2000;
  align-items:center;
  justify-content:center;
  flex-direction:column
}
.modal::before{
  content:"";position:absolute;inset:0;
  background-size:cover;background-position:center;
  filter:blur(25px) brightness(.5);
  transform:scale(1.1);z-index:-1
}
.visor{
  width:92%;max-width:900px;
  aspect-ratio:4/5;
  background:rgba(0,0,0,.6);
  border-radius:24px;
  display:flex;align-items:center;justify-content:center;
  overflow:hidden
}
.visor img,.visor iframe{
  width:100%;height:100%;
  object-fit:contain;border:none
}
.cerrar{
  position:absolute;top:20px;right:25px;
  font-size:40px;color:white;cursor:pointer
}
.controles{margin-top:15px;display:flex;gap:40px}
.controles button{
  background:rgba(255,255,255,.2);
  border:none;color:white;
  font-size:26px;padding:12px 26px;
  border-radius:50%;cursor:pointer
}
.descargar{
  margin-top:12px;
  background:rgba(255,255,255,.15);
  color:white;
  border:1px solid rgba(255,255,255,.4);
  padding:8px 18px;border-radius:20px;
  font-size:14px;cursor:pointer
}
.ios-tip{
  margin-top:8px;font-size:13px;
  color:#f1d6de;display:none
}
.contador{margin-top:8px;color:white;font-size:13px}
</style>
</head>

<body>

<div class="container">
  <h1>Alejandra & Ever</h1>
  <div class="fecha">üíç 5 ¬∑ septiembre ¬∑ 2026</div>

  <div class="card">
    <p>
      Gracias por acompa√±arnos en uno de los d√≠as m√°s felices de nuestras vidas üíï  
      Ay√∫danos a guardar estos recuerdos para siempre.
    </p>

    <input type="file" id="file" multiple accept="image/*,video/*"><br>
    <button id="btnSubir">Subir recuerdos üì∏üé•</button>
    <p id="estado"></p>
  </div>

  <h2 style="margin-top:50px;">Nuestros recuerdos üíï</h2>

  <div class="carousel">
    <button class="flecha izq" onclick="mover(-1)">‚óÄ</button>
    <div class="track" id="galeria"></div>
    <button class="flecha der" onclick="mover(1)">‚ñ∂</button>
  </div>

  <button id="btnVerTodos" style="margin-top:30px">
    Ver todos los recuerdos üíñ
  </button>
</div>

<div id="modal" class="modal">
  <span class="cerrar" onclick="cerrarModal()">√ó</span>
  <div class="visor"><div id="modalContenido"></div></div>

  <button id="btnDescargar" class="descargar">Guardar recuerdo ‚¨áÔ∏è</button>
  <div id="iosTip" class="ios-tip">
    En iPhone, mant√©n presionada la imagen y toca ‚ÄúGuardar en Fotos‚Äù üíï
  </div>

  <div class="controles">
    <button onclick="anterior()">‚óÄ</button>
    <button onclick="siguiente()">‚ñ∂</button>
  </div>
  <div id="contador" class="contador"></div>
</div>

<script>
const SCRIPT_URL="https://script.google.com/macros/s/AKfycbx8VOYLQROH9355Usvu2M7mguRZ8L8X4rL9kKtkH7lTak6JRmXgQkL9BCsRWOE61b2f/exec";
const isIOS=/iPad|iPhone|iPod/.test(navigator.userAgent);

let recuerdos=[],fotos=[],idx=0,ci=0,auto=null;

/* AUTOPLAY */
function iniciarAuto(){
  clearInterval(auto);
  auto=setInterval(()=>mover(1),3500);
}

/* CARGAR */
async function cargar(){
  recuerdos=await fetch(SCRIPT_URL).then(r=>r.json());
  fotos=recuerdos.filter(r=>r.type==="image");
  renderCarrusel();
  iniciarAuto();
}
cargar();

/* CARRUSEL */
function renderCarrusel(){
  galeria.innerHTML="";
  fotos.forEach(f=>{
    const i=document.createElement("img");
    i.src=f.url;galeria.appendChild(i);
  });
  ci=0;
  galeria.style.transform="translateX(0)";
}
function mover(d){
  if(!fotos.length)return;
  ci=(ci+d+fotos.length)%fotos.length;
  galeria.style.transform=`translateX(-${ci*195}px)`;
  iniciarAuto();
}

/* MODAL */
btnVerTodos.onclick=()=>{
  if(!recuerdos.length)return;
  idx=0;mostrar();modal.style.display="flex";
};

function extraerId(url){
  const m=url.match(/id=([^&]+)/);
  return m?m[1]:null;
}

function mostrar(){
  const r=recuerdos[idx];
  modalContenido.innerHTML="";
  modal.style.backgroundImage=r.type==="image"?`url(${r.url})`:"none";

  if(r.type==="image"){
    const img=document.createElement("img");
    img.src=r.url;modalContenido.appendChild(img);

    const id=extraerId(r.url);
    const downloadUrl=`https://drive.google.com/uc?export=download&id=${id}`;

    btnDescargar.style.display="inline-block";
    iosTip.style.display=isIOS?"block":"none";

    btnDescargar.onclick=()=>{
      window.location.href = downloadUrl;
    };
  }else{
    const f=document.createElement("iframe");
    f.src=r.url;f.allow="autoplay";
    modalContenido.appendChild(f);
    btnDescargar.style.display="none";
    iosTip.style.display="none";
  }
  contador.innerText=`${idx+1} / ${recuerdos.length}`;
}

function siguiente(){idx=(idx+1)%recuerdos.length;mostrar()}
function anterior(){idx=(idx-1+recuerdos.length)%recuerdos.length;mostrar()}
function cerrarModal(){modal.style.display="none"}
</script>

</body>
</html>
