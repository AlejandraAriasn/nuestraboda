<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Alejandra & Ever üíç</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body {
    margin: 0;
    font-family: "Georgia", serif;
    background: linear-gradient(#fff, #f9f6f7);
    color: #7b1e3a;
    text-align: center;
  }
  .container { max-width: 720px; margin: auto; padding: 40px 20px; }
  h1, h2 { margin: 10px 0; }
  .card {
    background: white;
    padding: 32px;
    border-radius: 26px;
    box-shadow: 0 14px 35px rgba(0,0,0,.08);
    margin-bottom: 40px;
  }
  button {
    background: #7b1e3a;
    color: white;
    border: none;
    padding: 15px 40px;
    border-radius: 30px;
    font-size: 18px;
    cursor: pointer;
  }
  button:hover { opacity: .9; }
  input, textarea {
    width: 90%;
    max-width: 400px;
    padding: 12px;
    border-radius: 15px;
    border: 1px solid #ccc;
    margin: 8px 0;
    font-family: inherit;
  }
  textarea{ resize:none; height:90px; }

  /* CARRUSEL */
  .carousel { position: relative; overflow: hidden; margin-top: 20px; }
  .track { display: flex; gap: 15px; transition: transform .6s ease; }
  .track img {
    width: 180px; height: 180px;
    object-fit: cover; border-radius: 18px;
    box-shadow: 0 8px 20px rgba(0,0,0,.15);
    cursor: pointer;
  }
  .flecha {
    position: absolute; top: 50%;
    transform: translateY(-50%);
    background: rgba(0,0,0,.55);
    color: white; border:none;
    font-size: 26px; padding: 10px 16px;
    border-radius:50%; cursor: pointer; z-index:2;
  }
  .izq{ left:10px; }
  .der{ right:10px; }

  /* MODAL RECUERDOS */
  .modal {
    display: none; position: fixed; inset: 0;
    background: rgba(0,0,0,.92);
    z-index: 2000;
    align-items: center; justify-content: center;
    flex-direction: column;
  }
  .visor {
    width: 92%; max-width: 900px; height: 80vh;
    background: rgba(0,0,0,.6);
    border-radius: 24px;
    display: flex; align-items: center; justify-content: center;
    overflow: hidden; position: relative;
  }
  .visor img, .visor iframe {
    width:100%; height:100%; object-fit: contain; border:none;
  }
  .cerrar {
    position: absolute; top: 20px; right: 25px;
    font-size: 40px; color: white; cursor: pointer;
  }
  .controles {
    margin-top: 15px; display: flex; gap: 40px;
  }
  .controles button {
    background: rgba(255,255,255,.2); border:none;
    color:white; font-size:26px; padding:12px 26px;
    border-radius:50%; cursor:pointer;
  }
  .descargar {
    position:absolute; bottom: 28px;
    background: rgba(255,255,255,.15);
    color:white; border:1px solid rgba(255,255,255,.4);
    padding:8px 18px; border-radius:20px;
    font-size:14px; cursor:pointer;
  }
  .contador {
    position:absolute; top:22px; right:70px;
    font-size:14px; color:white; opacity:.85;
  }

  /* OVERLAY DE CARGA */
  .overlay{
    position: fixed; inset:0;
    background: rgba(255,255,255,.96);
    display:none;
    align-items:center;
    justify-content:center;
    flex-direction:column;
    z-index:3000;
  }
  .loader{
    display:flex; gap:10px;
  }
  .loader span{
    font-size:30px; color:#7b1e3a;
    animation:latir 1.4s infinite ease-in-out;
  }
  @keyframes latir{
    0%{transform:scale(1);opacity:.4}
    20%{transform:scale(1.4);opacity:1}
    40%{transform:scale(1);opacity:.4}
    100%{transform:scale(1);opacity:.4}
  }

  /* MENSAJES SECTION */
  .mensajes {
    margin-top:50px;
  }
  .msg-card{
    background:white;
    border-radius:18px;
    padding:22px;
    margin:12px auto;
    max-width:500px;
    box-shadow:0 8px 20px rgba(0,0,0,.12);
    animation:fadeUp .5s ease;
  }
  @keyframes fadeUp{
    from{opacity:0;transform:translateY(15px)}
    to{opacity:1;transform:none}
  }
  .corazon{
    position:fixed; top:-30px;
    font-size:22px;
    color:#e2557b;
    animation:caer 4s linear forwards;
    z-index:3001;
  }
  @keyframes caer{
    to{transform:translateY(110vh);opacity:0}
  }
</style>
</head>

<body>

<div class="container">

  <!-- SUBIR RECUERDOS -->
  <div class="card">
    <h1>üíç Alejandra & Ever</h1>
    <p>Gracias por acompa√±arnos en uno de los d√≠as m√°s felices üíñ<br>Ay√∫danos a guardar estos recuerdos.</p>
    <input type="file" id="file" multiple accept="image/*,video/*">
    <br><br>
    <button onclick="subirRecuerdos()">Subir recuerdos üì∏üé•</button>
  </div>

  <!-- CARRUSEL -->
  <div class="card">
    <h2>Nuestros recuerdos üíû</h2>
    <div class="carousel">
      <button class="flecha izq" onclick="mover(-1)">‚óÄ</button>
      <div class="track" id="galeria"></div>
      <button class="flecha der" onclick="mover(1)">‚ñ∂</button>
    </div>
    <button onclick="abrirModal()">Ver todos los recuerdos üíñ</button>
  </div>

  <!-- MENSAJES -->
  <div class="card mensajes">
    <h2>üíå D√©janos un mensaje de amor</h2>
    <input id="nombre" placeholder="Tu nombre">
    <textarea id="mensaje" placeholder="Escribe algo lindo‚Ä¶"></textarea>
    <br>
    <button onclick="enviarMensaje()">Enviar mensaje üíï</button>
    <h3 id="contadorMensajes"></h3>
    <input placeholder="Buscar por nombre‚Ä¶" oninput="buscarMensajes(this.value)">
    <div id="listaMensajes"></div>
  </div>

</div>

<!-- OVERLAY DE CARGA -->
<div id="overlay" class="overlay">
  <div class="loader"><span>‚ù§</span><span>‚ù§</span><span>‚ù§</span></div>
  <p>Guardando tu recuerdo con amor‚Ä¶ üíñ</p>
</div>

<!-- MODAL RECUERDOS -->
<div id="modal" class="modal">
  <span class="cerrar" onclick="cerrarModal()">√ó</span>
  <div class="visor" id="visor">
    <button class="nav izq" onclick="anterior()">‚ùÆ</button>
    <button class="nav der" onclick="siguiente()">‚ùØ</button>
    <div id="modalContenido"></div>
    <div id="contador" class="contador"></div>
  </div>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbyMWZyzjjH4OqgaMr7NJkpIKWO6JMmUBKowwZDZAIYRHwmmo-MVwbqTlbOaZ-soaDEb/exec";

/* ===== CARGAR RECUERDOS ===== */
let recuerdos = [], fotos = [], idx = 0, autoplay;

async function cargarRecuerdos(){
  recuerdos = await fetch(API).then(r=>r.json());
  fotos = recuerdos.filter(r=>r.type==="image");
  renderCarrusel();
  iniciarAuto();
}
cargarRecuerdos();

function renderCarrusel(){
  galeria.innerHTML="";
  fotos.forEach((f)=>{
    const img=document.createElement("img");
    img.src=f.url;
    img.onclick=()=>{ abrirModalConFoto(f.url) };
    galeria.appendChild(img);
  });
}

function mover(dir){
  if(!fotos.length)return;
  idx=(idx+dir+fotos.length)%fotos.length;
  galeria.style.transform=`translateX(-${idx*195}px)`;
}

function iniciarAuto(){
  clearInterval(autoplay);
  autoplay=setInterval(()=>mover(1),3500);
}

async function subirRecuerdos(){
  const f=file.files;
  if(!f.length){ alert("Selecciona al menos un archivo üíï"); return; }
  overlay.style.display="flex";
  for(const each of f){
    const b=await each.arrayBuffer();
    await fetch(API,{
      method:"POST",
      body:JSON.stringify({
        name:each.name,
        type:each.type,
        base64:btoa(String.fromCharCode(...new Uint8Array(b)))
      })
    });
  }
  overlay.style.display="none";
  cargarRecuerdos();
}

/* ===== MODAL RECUERDOS ===== */
function abrirModalConFoto(url){
  mostrarModal(url,"image");
  modal.style.display="flex";
}

function mostrarModal(url,type){
  modalContenido.innerHTML="";
  if(type==="image"){
    modalContenido.innerHTML=`<img src="${url}">`;
  } else {
    modalContenido.innerHTML=`<iframe src="${url}" allow="autoplay"></iframe>`;
  }
  contador.innerText=`${idx+1} / ${recuerdos.length}`;
}
function cerrarModal(){ modal.style.display="none"; }
function siguiente(){ idx=(idx+1)%recuerdos.length; mostrarModal(recuerdos[idx].url,recuerdos[idx].type); }
function anterior(){ idx=(idx-1+recuerdos.length)%recuerdos.length; mostrarModal(recuerdos[idx].url,recuerdos[idx].type); }

/* ===== MENSAJES ===== */
async function enviarMensaje(){
  const n=nombre.value, m=mensaje.value;
  if(!n||!m){ alert("Completa ambos campos üíï"); return; }
  await fetch(API,{ method:"POST", body:JSON.stringify({ nombre:n,mensaje:m }) });
  nombre.value=""; mensaje.value="";
  cargarMensajes();
  lluviaCorazones();
}

async function cargarMensajes(){
  const data=await fetch(API+"?mensajes=1").then(r=>r.json());
  data.sort((a,b)=>new Date(b.fecha)-new Date(a.fecha));
  document.getElementById("contadorMensajes").innerText=`üíñ ${data.length} mensajes de amor`;
  renderMensajes(data);
}

function renderMensajes(arr){
  listaMensajes.innerHTML="";
  arr.forEach(m=>{
    const d=document.createElement("div");
    d.className="msg-card";
    d.innerHTML=`<b>${m.nombre}</b><br>${m.mensaje}`;
    listaMensajes.appendChild(d);
  });
}

function buscarMensajes(q){
  const cards=[...document.querySelectorAll(".msg-card")];
  cards.forEach(c=>{
    c.style.display=c.innerText.toLowerCase().includes(q.toLowerCase())?"" :"none";
  });
}

cargarMensajes();

/* ===== LLUVIA CORAZONES ===== */
function lluviaCorazones(){
  for(let i=0;i<20;i++){
    const c=document.createElement("div");
    c.className="corazon";
    c.innerText="‚ù§";
    c.style.left=Math.random()*100+"vw";
    c.style.animationDuration=2+Math.random()*2+"s";
    document.body.appendChild(c);
    setTimeout(()=>c.remove(),5000);
  }
}
</script>

</body>
</html>
