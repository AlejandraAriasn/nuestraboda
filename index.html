<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Alejandra & Ever üíç</title>

<style>
:root{
  --vino:#7b1e3a;
  --rosa:#f6c1cc;
  --blanco:#fff;
}

body{
  margin:0;
  font-family:"Georgia",serif;
  background:#111;
  color:var(--vino);
  text-align:center;
}

/* ===== CONTENEDORES ===== */
.card{
  background:white;
  max-width:900px;
  margin:40px auto;
  padding:30px;
  border-radius:30px;
  box-shadow:0 20px 40px rgba(0,0,0,.3);
}

h1,h2{margin:10px 0}

/* ===== BOTONES ===== */
button{
  background:var(--vino);
  color:white;
  border:none;
  padding:14px 30px;
  border-radius:40px;
  font-size:16px;
  cursor:pointer;
}
button:hover{opacity:.9}

/* ===== INPUT ===== */
input,textarea{
  width:90%;
  max-width:400px;
  padding:12px;
  border-radius:15px;
  border:1px solid #ccc;
  margin:8px 0;
  font-family:inherit;
}

/* ===== CARRUSEL ===== */
.carousel{
  position:relative;
  max-width:800px;
  margin:20px auto;
}
.carousel-item{
  width:100%;
  height:420px;
  border-radius:25px;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
  background:#000;
}
.carousel img,
.carousel video{
  max-width:100%;
  max-height:100%;
  object-fit:contain;
  cursor:pointer;
}
.nav{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  font-size:30px;
  color:white;
  background:rgba(0,0,0,.5);
  border-radius:50%;
  width:55px;
  height:55px;
  display:flex;
  align-items:center;
  justify-content:center;
}
.nav.left{left:-10px}
.nav.right{right:-10px}

/* ===== MODAL ===== */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.9);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:99;
}
.modal-content{
  max-width:90%;
  max-height:80%;
}
.modal img,.modal video{
  max-width:100%;
  max-height:100%;
}
.close{
  position:absolute;
  top:20px;
  right:20px;
  font-size:30px;
  color:white;
  cursor:pointer;
}

/* ===== OVERLAY CARGA ===== */
.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  display:none;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  color:white;
  z-index:100;
}
.heart{
  font-size:50px;
  animation:pulse 1s infinite;
}
@keyframes pulse{
  0%{transform:scale(1)}
  50%{transform:scale(1.3)}
  100%{transform:scale(1)}
}

/* ===== MENSAJES ===== */
.msg-card{
  background:#fff;
  border-radius:20px;
  padding:20px;
  margin:15px auto;
  max-width:500px;
  animation:fadeUp .5s ease;
}
@keyframes fadeUp{
  from{opacity:0;transform:translateY(20px)}
  to{opacity:1;transform:none}
}
</style>
</head>

<body>

<div class="card">
<h1>üíç Alejandra & Ever</h1>
<p>Gracias por acompa√±arnos üíñ Ay√∫danos a guardar estos recuerdos para siempre.</p>

<input type="file" id="files" multiple accept="image/*,video/*"/>
<br><br>
<button onclick="subir()">Subir recuerdos üì∏üé•</button>
</div>

<div class="card">
<h2>Nuestros recuerdos üíû</h2>
<div class="carousel">
  <div class="nav left" onclick="prev()">‚ùÆ</div>
  <div class="carousel-item" id="slide"></div>
  <div class="nav right" onclick="next()">‚ùØ</div>
</div>
<p id="contador"></p>
<button onclick="abrirGaleria()">Ver todos los recuerdos üíñ</button>
</div>

<div class="card">
<h2>D√©janos un mensaje üíå</h2>
<input id="nombre" placeholder="Tu nombre"/>
<textarea id="mensaje" placeholder="Tu mensaje lindo üíï"></textarea>
<br>
<button onclick="enviarMensaje()">Enviar mensaje</button>
</div>

<div class="card">
<h2 id="totalMensajes"></h2>
<input placeholder="Buscar por nombre‚Ä¶" oninput="buscar(this.value)"/>
<div id="listaMensajes"></div>
</div>

<!-- MODAL -->
<div class="modal" id="modal" onclick="cerrarModal()">
  <span class="close">‚úï</span>
  <div class="modal-content" id="modalContent"></div>
</div>

<!-- OVERLAY -->
<div class="overlay" id="overlay">
  <div class="heart">üíñ</div>
  <p>Estamos guardando tus recuerdos con amor‚Ä¶</p>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbyMWZyzjjH4OqgaMr7NJkpIKWO6JMmUBKowwZDZAIYRHwmmo-MVwbqTlbOaZ-soaDEb/exec";
let recuerdos=[], idx=0, timer;

/* ===== CARGAR RECUERDOS ===== */
async function cargar(){
  recuerdos = await fetch(API).then(r=>r.json());
  idx=0;
  mostrar();
  auto();
}
function mostrar(){
  if(!recuerdos.length) return;
  const r = recuerdos[idx];
  const c = document.getElementById("slide");
  c.innerHTML = r.type==="image"
    ? `<img src="${r.url}" onclick="verGrande('${r.url}','image')">`
    : `<video src="${r.url}" muted></video>`;
  document.getElementById("contador").innerText=`${idx+1} / ${recuerdos.length}`;
}
function next(){idx=(idx+1)%recuerdos.length;mostrar();auto()}
function prev(){idx=(idx-1+recuerdos.length)%recuerdos.length;mostrar();auto()}
function auto(){
  clearInterval(timer);
  timer=setInterval(next,5000);
}

/* ===== SUBIR ===== */
async function subir(){
  const f=document.getElementById("files").files;
  if(!f.length){alert("Selecciona al menos un archivo üíñ");return;}
  document.getElementById("overlay").style.display="flex";
  for(const file of f){
    const b=await file.arrayBuffer();
    await fetch(API,{
      method:"POST",
      body:JSON.stringify({
        name:file.name,
        type:file.type,
        base64:btoa(String.fromCharCode(...new Uint8Array(b)))
      })
    });
  }
  document.getElementById("overlay").style.display="none";
  cargar();
}

/* ===== MODAL ===== */
function verGrande(url,type){
  const m=document.getElementById("modal");
  document.getElementById("modalContent").innerHTML=
    type==="image"
    ? `<img src="${url}"><br><a href="${url}" download>Guardar recuerdo ‚¨áÔ∏è</a>`
    : `<video src="${url}" controls></video>`;
  m.style.display="flex";
}
function cerrarModal(){document.getElementById("modal").style.display="none"}

/* ===== MENSAJES ===== */
async function enviarMensaje(){
  const n=nombre.value,m=mensaje.value;
  if(!n||!m)return alert("Completa ambos campos üíï");
  await fetch(API,{
    method:"POST",
    body:JSON.stringify({nombre:n,mensaje:m})
  });
  nombre.value=mensaje.value="";
  cargarMensajes();
}
async function cargarMensajes(){
  const data=await fetch(API+"?mensajes=1").then(r=>r.json());
  document.getElementById("totalMensajes").innerText=`üíñ ${data.length} mensajes de amor`;
  renderMensajes(data);
}
function renderMensajes(arr){
  const d=document.getElementById("listaMensajes");
  d.innerHTML="";
  arr.forEach(m=>{
    d.innerHTML+=`<div class="msg-card"><b>${m.nombre}</b><br>${m.mensaje}</div>`;
  });
}
function buscar(t){
  cargarMensajes().then(()=>{
    const cards=[...document.querySelectorAll(".msg-card")];
    cards.forEach(c=>{
      c.style.display=c.innerText.toLowerCase().includes(t.toLowerCase())?"":"none";
    });
  });
}

cargar();
cargarMensajes();
</script>
</body>
</html>
